{{- define "main" }}
  {{ $paginator := .Paginate (cond .IsHome (where site.RegularPages "Type" "in" site.Params.mainSections) (.Data.Pages) ) }}
  {{ $counter := 0 }}
  {{ range $paginator.Pages }}
  <article class="card{{ if eq $counter 0 }} card--featured{{ else if gt $counter 2 }} card--additional{{ end }}">
    {{- if .Params.feature }}
    {{- $thumbnail := .Params.feature }}
    {{- if not (in .Params.feature "http") }}
      {{- with .Resources.GetMatch .Params.feature }}
        {{- $image := . }}
        {{- $thumbnail = ($image.Fill "1280x400").RelPermalink }}
      {{- else }}
        {{- $thumbnail = .Params.feature }}
      {{- end }}
    {{- end }}
      <figure class="card__cover">
        <a href="{{ .RelPermalink }}"><img src="{{ $thumbnail }}" alt="{{ .Params.featureAlt | default .Params.featureCaption | default "A Decorative Image" }}" height="500px"></a>
      </figure>
    {{- end }}
    <div class="card__content">
      <div class="card__meta">
        {{ with .Params.Series }}<a href="/series/{{ . | urlize }}" class="card__series" data-taxonomy="{{ print "series-" . | urlize }}">{{ . }}</a>{{ end }}
        {{ with .PublishDate }}<time datetime="{{ . }}" class="card__date">{{ cond (eq (.Format "2006") (now.Format "2006")) (.Format "Jan 2") (.Format "2 Jan 2006") }}</time>{{ end }}
        {{/*  <span class="card__time">{{ .ReadingTime }} min read</span>  */}}
      </div>
      <h2 class="card__title"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
      <div class="card__description">{{ .Params.description | default (.Summary | truncate 200 "...") }}</div>
    </div>
  </article>
  {{ $counter = add $counter 1 }}
  {{- end }}
{{- end }}

{{- define "pagination" }}
  {{ partial "site/pagination" . }}
{{- end }}